.. _README:

===============
Software README
===============

The Mindboggle software package automates shape analysis of anatomical labels
and features extracted from human brain MR image data.
Mindboggle can be run as a single command, and can be
easily installed as a cross-platform virtual machine for convenience and
reproducibility of results. Behind the scenes runs open source
Python and C++ code within a Nipype pipeline framework.

Help
====
- See below for information about Mindboggle inputs and outputs.
- `Online documentation <http://mindboggle.info/documentation.html>`_
- `Installation instructions <INSTALL.html>`_
- Help on the command line in a terminal window::

    mindboggle --help

- `License <http://mindboggle.info/users/LICENSE.html>`_
- `Background <http://mindboggle.info/faq/background.html>`_
- `Contributors <THANKS.html>`_

Mindboggle
==========

    1. combines non/cortex segmentations from FreeSurfer and ANTs software packages
    2. propagates FreeSurfer and ANTs-registered labels through cortex and noncortex voxels
    3. computes label volumes and cortical label thicknesses
    4. computes shape measures on every vertex of FreeSurfer cortical surface meshes
    5. extracts cortical surface features
    6. computes statistics on shape measures per cortical surface label/feature:

        - Surface area
        - Travel depth
        - Geodesic depth
        - Mean curvature
        - Convexity (FreeSurfer)
        - Thickness (FreeSurfer)
        - Laplace-Beltrami spectra
        - Zernike moments [UNDER EVALUATION]

Examples
========
If running Mindboggle in a virtual machine (recommended),
type the following two commands in the same directory as the Vagrantfile
you generated (see `INSTALL <INSTALL.html>`_) to launch and log into the
Mindboggle virtual machine (requires an active internet connection)::

    vagrant up
    vagrant ssh

Once logged in, you can type the following in a terminal window to run
mindboggle on data that has been processed by FreeSurfer
(replace SUBJECT with the name of a subject directory created by FreeSurfer)::

    mindboggle SUBJECT

The following example also makes use ANTs output files and 8 processors
(replace SEGMENTS with the ANTs segmented output, such as
``ants_subjects/subject1/tmpBrainSegmentation.nii.gz``)::

    mindboggle SUBJECT --ants_segments SEGMENTS -n 8

This example uses many of the currently available options within Mindboggle
(backslash denotes a line return)::

    mindboggle SUBJECT --ants_segments SEGMENTS -n 8 \
               --sulci --fundi --vertices --spectra 10 --thickness --visual hier

Inputs
======
Mindboggle currently takes output from FreeSurfer_ (preferably v5.3 and above)
and the latest ANTs_ software packages.

**FreeSurfer** generates labeled cortical surfaces, and labeled cortical and
noncortical volumes. Run ``recon-all`` on a T1-weighted IMAGE file
(e.g., subject1.nii.gz) and set the output SUBJECT name (e.g., to ``subject1``)::

    recon-all -all -i IMAGE -s SUBJECT

..
    - mri/orig/001.mgz
    - mri/[wmparc,aparc+aseg].mgz
    - surf/[lh,rh].pial
    - label/[lh,rh].aparc.annot

**ANTs** provides brain volume extraction, segmentation, and registration-based labeling.
To generate the ANTs transforms and segmentation files used by
Mindboggle, run the antsCorticalThickness.sh script on the same IMAGE file,
set an output PREFIX, and provide paths to
`OASIS-30 template <http://mindboggle.info/data/templates/atropos/OASIS-30_Atropos_template.tar.gz>`_
files::
    antsCorticalThickness.sh -d 3 -n 3 -w 0.25 \
      -a IMAGE \
      -o PREFIX \
      -e OASIS-30_Atropos_template/T_template0.nii.gz \
      -t OASIS-30_Atropos_template/T_template0.nii.gz \
      -m OASIS-30_Atropos_template/T_template0_BrainCerebellumProbabilityMask.nii.gz \
      -f OASIS-30_Atropos_template/T_template0_BrainCerebellumExtractionMask.nii.gz \
      -p OASIS-30_Atropos_template/Priors2/priors%d.nii.gz

Outputs
=======
By default, final outputs are saved in $HOME/mindboggled/ ($HOME is the
home directory). Nifti_ image volumes (.nii.gz) store anatomical labels
corresponding to the numbers listed in the mindboggle/LABELS.py file and
`online <http://mindboggle.info/data/mindboggle101/protocol.txt>`_;
all left and right cortical surface (.vtk) vertices are number-labeled
by anatomical label, feature, or shape measure. Shape measure statistics
are stored in tables (.csv).

+-+---------------+----------------------------------------------+--------------+
| |  **Folder**   | **Contents**                                 | **Format**   |
+-+---------------+----------------------------------------------+--------------+
| |   labels/     |  number-labeled surfaces and volumes         | .vtk, .nii.gz|
+-+---------------+----------------------------------------------+--------------+
| |   features/   |  surface features: folds, sulci, fundi       | .vtk         |
+-+---------------+----------------------------------------------+--------------+
| |   shapes/     |  surfaces with shape measures (per vertex)   | .vtk         |
+-+---------------+----------------------------------------------+--------------+
| |   tables/     |  tables of shape measures per label/feature  | .csv         |
+-+---------------+----------------------------------------------+--------------+

**mindboggled** / SUBJECT /

    **labels** /

        --- *Volume and surface labels* ---

        **FreeSurfer_wmparc_labels** .nii.gz:  *[FreeSurfer wmparc+aseg labels]*

        **FreeSurfer_wmparc_filled_labels** .nii.gz:  *[revised non/cortex each filled with FreeSurfer labels]*

        **ANTs_labels** .nii.gz:  *[ANTs-registered, joint-fusion atlas labels]*

        **ANTs_filled_labels** .nii.gz:  *[revised non/cortex each filled with ANTs labels + FreeSurfer cerebellar labels]*

        [left,right] _surface_ **FreeSurfer_cortex_labels** .vtk:  *[surface labels]*

        **ATLAS_labels** .nii.gz:  *["--add_atlases ATLAS" output for each ATLAS]*

    **features** /

        --- *Features extracted from cortical surface meshes* ---

        [left,right] _surface_ **folds** .vtk:  *[depth-based cortical surface folds (invaginations)]*

        [left,right] _surface_ **sulci** .vtk:  *[folds segmented into sulci using label pairs]*

        UNDER EVALUATION: [left,right] _surface_ **fundus_per_fold** .vtk:  *[curves running along depths of folds]*

        UNDER EVALUATION: [left,right] _surface_ **fundus_per_sulcus** .vtk:  *[fundus curves segmented by sulcus labels]*

    **shapes** /

        --- *Per-vertex surface shape measures* ---

        [left,right] _surface_ **area** .vtk

        [left,right] _surface_ **mean_curvature** .vtk

        [left,right] _surface_ **geodesic_depth** .vtk

        [left,right] _surface_ **travel_depth** .vtk

        [left,right] _surface_ **FreeSurfer_convexity** .vtk:  *[FreeSurfer's [lh,rh].sulc files]*

        [left,right] _surface_ **FreeSurfer_thickness** .vtk:  *[FreeSurfer's [lh,rh].thickness files]*

    **tables** /

        --- *Tables with per-label volumes and thicknesses* ---

        **FreeSurfer_filled_labels_volumes** .csv

        **FreeSurfer_filled_labels_volumes_areas_thicknesses** .csv

        **ANTs_filled_labels_volumes** .csv

        **ANTs_filled_labels_volumes_areas_thicknesses** .csv

        **ATLAS_labels_volumes** .csv:  *["--add_atlases ATLAS" output for each ATLAS]*

        --- *Tables with per-label or per-feature surface shape statistics* ---

        [left,right] _surface_ **label_shapes** .csv

        [left,right] _surface_ **sulcus_shapes** .csv

        UNDER EVALUATION: [left,right] _surface_ **fundus_shapes** .csv

        --- *Table with per-vertex shape measures* ---

        [left,right] _surface_ **vertices** .csv

