# Configuration file for circleci.com continuous integration (testing)

machine:

  python:
    version: 3.5.1

  environment:
    MINI: $HOME/miniconda3
#    MB: $HOME/mindboggle
#    vtk_cpp_tools: $MB/vtk_cpp_tools/bin
#    PATH: $MINI/bin:$vtk_cpp_tools:$PATH

#general:

#  build_dir: mindboggle

dependencies:

  pre:

    #-------------------------------------------------------------------------
    # Install system-wide dependencies in Linux:
    #-------------------------------------------------------------------------
#    - sudo apt-get update
#    - sudo apt-get install g++ git make xorg
    #-------------------------------------------------------------------------
    # Fix paths to Linux libraries using symbolic links
    #-------------------------------------------------------------------------
    # To avoid the following errors:
    # "No rule to make target `/usr/lib/x86_64-linux-gnu/libGLU.so'"
    # ...
    # http://techtidings.blogspot.com/2012/01/problem-with-libglso-on-64-bit-ubuntu.html
    - sudo mkdir /usr/lib64
    - sudo ln -s /usr/lib/x86_64-linux-gnu/libGLU.so.1 /usr/lib64/libGLU.so
    - sudo ln -s /usr/lib/x86_64-linux-gnu/libSM.so.6 /usr/lib64/libSM.so
    - sudo ln -s /usr/lib/x86_64-linux-gnu/libICE.so.6 /usr/lib64/libICE.so
    - sudo ln -s /usr/lib/x86_64-linux-gnu/libX11.so.6 /usr/lib64/libX11.so
    - sudo ln -s /usr/lib/x86_64-linux-gnu/libXext.so.6 /usr/lib64/libXext.so
    - sudo ln -s /usr/lib/x86_64-linux-gnu/libXt.so.6 /usr/lib64/libXt.so
    - sudo ln -s /usr/lib/x86_64-linux-gnu/mesa/libGL.so.1 /usr/lib64/libGL.so
    #-------------------------------------------------------------------------
    # Install conda and add it to PATH:
    #-------------------------------------------------------------------------
    - wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh;
    - bash miniconda.sh -b -p /home/ubuntu/miniconda3  # $MINI
    - conda config --set always_yes yes
    #-------------------------------------------------------------------------
    # Install VTK:
    #-------------------------------------------------------------------------
    - conda install -c https://conda.anaconda.org/clinicalgraphics vtk
    #-------------------------------------------------------------------------
    # Install nipype:
    #-------------------------------------------------------------------------
#    - conda install pip scipy nose networkx lxml future simplejson
#    - pip install nibabel prov xvfbwrapper traits
#    - pip install https://github.com/nipy/nipype/archive/master.zip
    #-------------------------------------------------------------------------
    # Install optional graphviz and pygraphviz for generating nipype graphs:
    #-------------------------------------------------------------------------
#    - sudo apt-get install graphviz libgraphviz-dev
#    - pip install --upgrade pygraphviz graphviz

    #-------------------------------------------------------------------------
    # Install additional testing tools for circleci.com:
    #-------------------------------------------------------------------------
#    - conda install ipython pytest coverage  # nose
    #-------------------------------------------------------------------------
    # Install Mindboggle's remaining dependencies and C++ code
    #-------------------------------------------------------------------------
#    - conda install cmake matplotlib numpy pandas
#    - mkdir $vtk_cpp_tools && cd $vtk_cpp_tools && cmake ../ && make

test:

  pre:
    - conda --version
    - python -c "import vtk"
#    - nosetests --with-coverage --with-doctest evaluate/
#    - nosetests --with-coverage --with-doctest features/
#    - nosetests --with-coverage --with-doctest guts/
#    - nosetests --with-coverage --with-doctest mio/
#    - nosetests --with-coverage --with-doctest shapes/
#    - nosetests --with-coverage --with-doctest thirdparty/
    #- coveralls